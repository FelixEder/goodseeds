{"version":3,"sources":["../../src/utils/events.js"],"names":["pathStrToObj","path","pathObj","type","isQuery","queryId","pathArray","split","Object","assign","queryParams","populates","p","indexOf","getEventsFromInput","paths","String","Array","isArray","Error","strPath","storeAs","join"],"mappings":"+eASO,QAASA,CAAAA,YAAT,CAAsBC,IAAtB,CAA4B,IAC7BC,CAAAA,OAAO,CAAG,CAAED,IAAI,CAAJA,IAAF,CAAQE,IAAI,CAAE,OAAd,CAAuBC,OAAO,GAA9B,CADmB,CAE3BC,OAAO,CAAG,8BAAmBJ,IAAnB,CAFiB,CAIjC,GAAII,OAAJ,CAAa,CACX,GAAMC,CAAAA,SAAS,CAAGL,IAAI,CAACM,KAAL,CAAW,GAAX,CAAlB,CACAL,OAAO,CAAGM,MAAM,CAACC,MAAP,CAAc,EAAd,CAAkBP,OAAlB,CAA2B,CACnCG,OAAO,CAAPA,OADmC,CAEnCD,OAAO,GAF4B,CAGnCH,IAAI,CAAEK,SAAS,CAAC,CAAD,CAHoB,CAInCI,WAAW,CAAEJ,SAAS,CAAC,CAAD,CAAT,CAAaC,KAAb,CAAmB,GAAnB,CAJsB,CAA3B,CAFC,CAQP,2BAAaD,SAAS,CAAC,CAAD,CAAT,CAAaC,KAAb,CAAmB,GAAnB,CAAb,CARO,GASTL,OAAO,CAACS,SAAR,CAAoB,2BAAaL,SAAS,CAAC,CAAD,CAAT,CAAaC,KAAb,CAAmB,GAAnB,CAAb,CATX,CAUTL,OAAO,CAACQ,WAAR,CAAsB,qBACpBJ,SAAS,CAAC,CAAD,CAAT,CAAaC,KAAb,CAAmB,GAAnB,CADoB,CAEpB,SAAAK,CAAC,QAA8B,CAAC,CAA3B,GAAAA,CAAC,CAACC,OAAF,CAAU,UAAV,CAAJ,CAFmB,CAVb,CAeZ,CAED,MAAOX,CAAAA,OACR,CAOM,QAASY,CAAAA,kBAAT,CAA4BC,KAA5B,CAAmC,CACxC,MAAO,sBAAQA,KAAR,CAAe,SAAAd,IAAI,CAAI,CAE5B,GAAoB,QAAhB,QAAOA,CAAAA,IAAP,EAA4BA,IAAI,WAAYe,CAAAA,MAAhD,CACE,MAAO,CAAChB,YAAY,CAACC,IAAD,CAAb,CAAP,CAGF,GAAIgB,KAAK,CAACC,OAAN,CAAcjB,IAAd,CAAJ,CAGE,MAAO,CACL,CAAEE,IAAI,CAAE,aAAR,CAAuBF,IAAI,CAAEA,IAAI,CAAC,CAAD,CAAjC,CADK,CAEL,CAAEE,IAAI,CAAE,aAAR,CAAuBF,IAAI,CAAEA,IAAI,CAAC,CAAD,CAAjC,CAFK,CAGL,CAAEE,IAAI,CAAE,eAAR,CAAyBF,IAAI,CAAEA,IAAI,CAAC,CAAD,CAAnC,CAHK,CAIL,CAAEE,IAAI,CAAE,aAAR,CAAuBF,IAAI,CAAEA,IAAI,CAAC,CAAD,CAAjC,CAJK,CAKL,CAAEE,IAAI,CAAE,eAAR,CAAyBF,IAAI,CAAEA,IAAI,CAAC,CAAD,CAAnC,CALK,CAAP,CASF,GAAI,uBAASA,IAAT,CAAJ,CAAoB,CAClB,GAAI,CAACA,IAAI,CAACA,IAAV,CACE,KAAM,IAAIkB,CAAAA,KAAJ,CAAU,uDAAV,CAAN,CAEF,GAAIC,CAAAA,OAAO,CAAGnB,IAAI,CAACA,IAAnB,CAcA,MAZIA,CAAAA,IAAI,CAACoB,OAYT,GAVED,OAAO,aAAQnB,IAAI,CAACoB,OAAb,CAUT,EAPIpB,IAAI,CAACS,WAOT,GALEU,OAAO,aAAQnB,IAAI,CAACS,WAAL,CAAiBY,IAAjB,CAAsB,GAAtB,CAAR,CAKT,EADArB,IAAI,CAAGO,MAAM,CAACC,MAAP,CAAc,EAAd,CAAkBT,YAAY,CAACoB,OAAD,CAA9B,CAAyCnB,IAAzC,CACP,CAAO,CAACA,IAAD,CACR,CAED,KAAM,IAAIkB,CAAAA,KAAJ,oCACwBlB,IADxB,kDAGP,CA1CM,CA2CR,C,aAEc,CAAEa,kBAAkB,CAAlBA,kBAAF,C","sourcesContent":["import { flatMap, isObject, remove } from 'lodash'\nimport { getPopulates } from './populate'\nimport { getQueryIdFromPath } from './query'\n\n/**\n * @description Convert path string to object with queryParams, path, and populates\n * @param {string} path - Path that can contain query parameters and populates\n * @returns {object} watchEvents - Array of watch events\n */\nexport function pathStrToObj(path) {\n  let pathObj = { path, type: 'value', isQuery: false }\n  const queryId = getQueryIdFromPath(path)\n  // If Query id exists split params from path\n  if (queryId) {\n    const pathArray = path.split('#')\n    pathObj = Object.assign({}, pathObj, {\n      queryId,\n      isQuery: true,\n      path: pathArray[0],\n      queryParams: pathArray[1].split('&')\n    })\n    if (getPopulates(pathArray[1].split('&'))) {\n      pathObj.populates = getPopulates(pathArray[1].split('&'))\n      pathObj.queryParams = remove(\n        pathArray[1].split('&'),\n        p => p.indexOf('populate') === -1\n      )\n    }\n  }\n  // if queryId does not exist, return original pathObj\n  return pathObj\n}\n\n/**\n * @description Convert watch path definition array to watch events\n * @param {Array} paths - Array of path strings, objects, and arrays to watch\n * @returns {Array} watchEvents - Array of watch events\n */\nexport function getEventsFromInput(paths) {\n  return flatMap(paths, path => {\n    // If path is a string - convert to obj and place within new array\n    if (typeof path === 'string' || path instanceof String) {\n      return [pathStrToObj(path)]\n    }\n\n    if (Array.isArray(path)) {\n      // TODO: Handle input other than array with string\n      // TODO: Handle populates within array\n      return [\n        { type: 'first_child', path: path[0] },\n        { type: 'child_added', path: path[0] },\n        { type: 'child_removed', path: path[0] },\n        { type: 'child_moved', path: path[0] },\n        { type: 'child_changed', path: path[0] }\n      ]\n    }\n\n    if (isObject(path)) {\n      if (!path.path) {\n        throw new Error('Path is a required parameter within definition object')\n      }\n      let strPath = path.path\n\n      if (path.storeAs) {\n        // append storeAs to query path\n        strPath += `@${path.storeAs}`\n      }\n\n      if (path.queryParams) {\n        // append query params to path for queryId added in pathStrToObj\n        strPath += `#${path.queryParams.join('&')}`\n      }\n\n      // Add all parameters that are missing (ones that exist will remain)\n      path = Object.assign({}, pathStrToObj(strPath), path)\n      return [path]\n    }\n\n    throw new Error(\n      `Invalid Path Definition: ${path}. Only strings, objects, and arrays accepted.`\n    )\n  })\n}\n\nexport default { getEventsFromInput }\n"],"file":"events.js"}