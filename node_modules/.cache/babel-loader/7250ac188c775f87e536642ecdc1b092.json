{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.add = add;\nexports.set = set;\nexports.get = get;\nexports.update = update;\nexports.deleteRef = deleteRef;\nexports.setListener = setListener;\nexports.setListeners = setListeners;\nexports.unsetListener = unsetListener;\nexports.unsetListeners = unsetListeners;\nexports.runTransaction = runTransaction;\nexports.default = void 0;\n\nvar _every2 = _interopRequireDefault(require(\"lodash/every\"));\n\nvar _actions = require(\"../utils/actions\");\n\nvar _constants = require(\"../constants\");\n\nvar _query = require(\"../utils/query\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar pathListenerCounts = {};\n\nfunction add(firebase, dispatch, queryOption) {\n  for (var _len = arguments.length, args = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n    args[_key - 3] = arguments[_key];\n  }\n\n  var meta = (0, _query.getQueryConfig)(queryOption);\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, meta),\n    method: 'add',\n    meta: meta,\n    args: args,\n    types: [_constants.actionTypes.ADD_REQUEST, {\n      type: _constants.actionTypes.ADD_SUCCESS,\n      payload: function payload(snap) {\n        var obj = {\n          id: snap.id,\n          data: args[0]\n        };\n\n        _query.snapshotCache.set(obj, snap);\n\n        return obj;\n      }\n    }, _constants.actionTypes.ADD_FAILURE]\n  });\n}\n\nfunction set(firebase, dispatch, queryOption) {\n  var meta = (0, _query.getQueryConfig)(queryOption);\n\n  for (var _len2 = arguments.length, args = new Array(_len2 > 3 ? _len2 - 3 : 0), _key2 = 3; _key2 < _len2; _key2++) {\n    args[_key2 - 3] = arguments[_key2];\n  }\n\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, meta),\n    method: 'set',\n    meta: meta,\n    args: args,\n    types: [_constants.actionTypes.SET_REQUEST, _constants.actionTypes.SET_SUCCESS, _constants.actionTypes.SET_FAILURE]\n  });\n}\n\nfunction get(firebase, dispatch, queryOption) {\n  var meta = (0, _query.getQueryConfig)(queryOption);\n\n  var _ref = firebase._.config || {},\n      mergeOrdered = _ref.mergeOrdered,\n      mergeOrderedDocUpdates = _ref.mergeOrderedDocUpdates,\n      mergeOrderedCollectionUpdates = _ref.mergeOrderedCollectionUpdates;\n\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, meta),\n    method: 'get',\n    meta: meta,\n    types: [_constants.actionTypes.GET_REQUEST, {\n      type: _constants.actionTypes.GET_SUCCESS,\n      payload: function payload(snap) {\n        return {\n          data: (0, _query.dataByIdSnapshot)(snap),\n          ordered: (0, _query.orderedFromSnap)(snap)\n        };\n      },\n      merge: {\n        docs: mergeOrdered && mergeOrderedDocUpdates,\n        collections: mergeOrdered && mergeOrderedCollectionUpdates\n      }\n    }, _constants.actionTypes.GET_FAILURE]\n  });\n}\n\nfunction update(firebase, dispatch, queryOption) {\n  var meta = (0, _query.getQueryConfig)(queryOption);\n\n  for (var _len3 = arguments.length, args = new Array(_len3 > 3 ? _len3 - 3 : 0), _key3 = 3; _key3 < _len3; _key3++) {\n    args[_key3 - 3] = arguments[_key3];\n  }\n\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, meta),\n    method: 'update',\n    meta: meta,\n    args: args,\n    types: [_constants.actionTypes.UPDATE_REQUEST, _constants.actionTypes.UPDATE_SUCCESS, _constants.actionTypes.UPDATE_FAILURE]\n  });\n}\n\nfunction deleteRef(firebase, dispatch, queryOption) {\n  var meta = (0, _query.getQueryConfig)(queryOption);\n  var config = firebase._.config;\n\n  if (!meta.doc || meta.subcollections && !(0, _every2.default)(meta.subcollections, 'doc')) {\n    if (typeof config.onAttemptCollectionDelete === 'function') {\n      return config.onAttemptCollectionDelete(queryOption, dispatch, firebase);\n    }\n\n    return Promise.reject(new Error('Only documents can be deleted.'));\n  }\n\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, meta),\n    method: 'delete',\n    meta: meta,\n    types: [_constants.actionTypes.DELETE_REQUEST, {\n      type: _constants.actionTypes.DELETE_SUCCESS,\n      preserve: firebase._.config.preserveOnDelete\n    }, _constants.actionTypes.DELETE_FAILURE]\n  });\n}\n\nfunction setListener(firebase, dispatch, queryOpts, successCb, errorCb) {\n  var meta = (0, _query.getQueryConfig)(queryOpts);\n  var unsubscribe = (0, _query.firestoreRef)(firebase, meta).onSnapshot(function (docData) {\n    if (!meta.populates) {\n      (0, _query.dispatchListenerResponse)({\n        dispatch: dispatch,\n        docData: docData,\n        meta: meta,\n        firebase: firebase\n      });\n      if (typeof successCb === 'function') successCb(docData);\n      return;\n    }\n\n    (0, _query.getPopulateActions)({\n      firebase: firebase,\n      docData: docData,\n      meta: meta\n    }).then(function (populateActions) {\n      populateActions.forEach(function (populateAction) {\n        dispatch(_objectSpread({}, populateAction, {\n          type: _constants.actionTypes.LISTENER_RESPONSE,\n          timestamp: Date.now()\n        }));\n      });\n      (0, _query.dispatchListenerResponse)({\n        dispatch: dispatch,\n        docData: docData,\n        meta: meta,\n        firebase: firebase\n      });\n    }).catch(function (populateErr) {\n      var _ref2 = firebase._.config || {},\n          logListenerError = _ref2.logListenerError;\n\n      if (logListenerError !== false) {\n        if (logListenerError !== false && !!console && typeof console.error === 'function') {\n          console.error('redux-firestore error populating:', populateErr);\n        }\n      }\n\n      if (typeof errorCb === 'function') errorCb(populateErr);\n    });\n  }, function (err) {\n    var _ref3 = firebase._.config || {},\n        mergeOrdered = _ref3.mergeOrdered,\n        mergeOrderedDocUpdates = _ref3.mergeOrderedDocUpdates,\n        mergeOrderedCollectionUpdates = _ref3.mergeOrderedCollectionUpdates,\n        logListenerError = _ref3.logListenerError,\n        preserveOnListenerError = _ref3.preserveOnListenerError;\n\n    if (logListenerError !== false && !!console && typeof console.error === 'function') {\n      console.error('redux-firestore listener error:', err);\n    }\n\n    dispatch({\n      type: _constants.actionTypes.LISTENER_ERROR,\n      meta: meta,\n      payload: err,\n      merge: {\n        docs: mergeOrdered && mergeOrderedDocUpdates,\n        collections: mergeOrdered && mergeOrderedCollectionUpdates\n      },\n      preserve: preserveOnListenerError\n    });\n    if (typeof errorCb === 'function') errorCb(err);\n  });\n  (0, _query.attachListener)(firebase, dispatch, meta, unsubscribe);\n  return unsubscribe;\n}\n\nfunction setListeners(firebase, dispatch, listeners) {\n  if (!Array.isArray(listeners)) {\n    throw new Error('Listeners must be an Array of listener configs (Strings/Objects).');\n  }\n\n  var config = firebase._.config;\n\n  if (config.oneListenerPerPath) {\n    listeners.forEach(function (listener) {\n      var path = (0, _query.getQueryName)(listener);\n      var oldListenerCount = pathListenerCounts[path] || 0;\n      pathListenerCounts[path] = oldListenerCount + 1;\n\n      if (oldListenerCount > 0) {\n        return;\n      }\n\n      setListener(firebase, dispatch, listener);\n    });\n  } else {\n    var allowMultipleListeners = config.allowMultipleListeners;\n    listeners.forEach(function (listener) {\n      var path = (0, _query.getQueryName)(listener);\n      var oldListenerCount = pathListenerCounts[path] || 0;\n      var multipleListenersEnabled = typeof allowMultipleListeners === 'function' ? allowMultipleListeners(listener, firebase._.listeners) : allowMultipleListeners;\n      pathListenerCounts[path] = oldListenerCount + 1;\n\n      if (oldListenerCount === 0 || multipleListenersEnabled) {\n        setListener(firebase, dispatch, listener);\n      }\n    });\n  }\n}\n\nfunction unsetListener(firebase, dispatch, meta) {\n  return (0, _query.detachListener)(firebase, dispatch, (0, _query.getQueryConfig)(meta));\n}\n\nfunction unsetListeners(firebase, dispatch, listeners) {\n  if (!Array.isArray(listeners)) {\n    throw new Error('Listeners must be an Array of listener configs (Strings/Objects).');\n  }\n\n  var config = firebase._.config;\n  var allowMultipleListeners = config.allowMultipleListeners;\n  listeners.forEach(function (listener) {\n    var path = (0, _query.getQueryName)(listener);\n    var listenerExists = pathListenerCounts[path] >= 1;\n    var multipleListenersEnabled = typeof allowMultipleListeners === 'function' ? allowMultipleListeners(listener, firebase._.listeners) : allowMultipleListeners;\n\n    if (listenerExists) {\n      pathListenerCounts[path] -= 1;\n\n      if (pathListenerCounts[path] === 0 || multipleListenersEnabled) {\n        unsetListener(firebase, dispatch, listener);\n      }\n    }\n  });\n}\n\nfunction runTransaction(firebase, dispatch, transactionPromise) {\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: firebase.firestore(),\n    method: 'runTransaction',\n    args: [transactionPromise],\n    types: [_constants.actionTypes.TRANSACTION_START, _constants.actionTypes.TRANSACTION_SUCCESS, _constants.actionTypes.TRANSACTION_FAILURE]\n  });\n}\n\nvar _default = {\n  get: get,\n  firestoreRef: _query.firestoreRef,\n  add: add,\n  update: update,\n  setListener: setListener,\n  setListeners: setListeners,\n  unsetListener: unsetListener,\n  unsetListeners: unsetListeners,\n  runTransaction: runTransaction\n};\nexports.default = _default;","map":{"version":3,"sources":["/Users/Lara/Documents/Kurser/VT20/Dynwebb/goodseeds/node_modules/redux-firestore/es/actions/firestore.js"],"names":["Object","defineProperty","exports","value","add","set","get","update","deleteRef","setListener","setListeners","unsetListener","unsetListeners","runTransaction","default","_every2","_interopRequireDefault","require","_actions","_constants","_query","obj","__esModule","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","configurable","writable","pathListenerCounts","firebase","dispatch","queryOption","_len","args","Array","_key","meta","getQueryConfig","wrapInDispatch","ref","firestoreRef","method","types","actionTypes","ADD_REQUEST","type","ADD_SUCCESS","payload","snap","id","data","snapshotCache","ADD_FAILURE","_len2","_key2","SET_REQUEST","SET_SUCCESS","SET_FAILURE","_ref","_","config","mergeOrdered","mergeOrderedDocUpdates","mergeOrderedCollectionUpdates","GET_REQUEST","GET_SUCCESS","dataByIdSnapshot","ordered","orderedFromSnap","merge","docs","collections","GET_FAILURE","_len3","_key3","UPDATE_REQUEST","UPDATE_SUCCESS","UPDATE_FAILURE","doc","subcollections","onAttemptCollectionDelete","Promise","reject","Error","DELETE_REQUEST","DELETE_SUCCESS","preserve","preserveOnDelete","DELETE_FAILURE","queryOpts","successCb","errorCb","unsubscribe","onSnapshot","docData","populates","dispatchListenerResponse","getPopulateActions","then","populateActions","populateAction","LISTENER_RESPONSE","timestamp","Date","now","catch","populateErr","_ref2","logListenerError","console","error","err","_ref3","preserveOnListenerError","LISTENER_ERROR","attachListener","listeners","isArray","oneListenerPerPath","listener","path","getQueryName","oldListenerCount","allowMultipleListeners","multipleListenersEnabled","detachListener","listenerExists","transactionPromise","firestore","TRANSACTION_START","TRANSACTION_SUCCESS","TRANSACTION_FAILURE","_default"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.add = add;\nexports.set = set;\nexports.get = get;\nexports.update = update;\nexports.deleteRef = deleteRef;\nexports.setListener = setListener;\nexports.setListeners = setListeners;\nexports.unsetListener = unsetListener;\nexports.unsetListeners = unsetListeners;\nexports.runTransaction = runTransaction;\nexports.default = void 0;\n\nvar _every2 = _interopRequireDefault(require(\"lodash/every\"));\n\nvar _actions = require(\"../utils/actions\");\n\nvar _constants = require(\"../constants\");\n\nvar _query = require(\"../utils/query\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar pathListenerCounts = {};\n\nfunction add(firebase, dispatch, queryOption) {\n  for (var _len = arguments.length, args = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n    args[_key - 3] = arguments[_key];\n  }\n\n  var meta = (0, _query.getQueryConfig)(queryOption);\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, meta),\n    method: 'add',\n    meta: meta,\n    args: args,\n    types: [_constants.actionTypes.ADD_REQUEST, {\n      type: _constants.actionTypes.ADD_SUCCESS,\n      payload: function payload(snap) {\n        var obj = {\n          id: snap.id,\n          data: args[0]\n        };\n\n        _query.snapshotCache.set(obj, snap);\n\n        return obj;\n      }\n    }, _constants.actionTypes.ADD_FAILURE]\n  });\n}\n\nfunction set(firebase, dispatch, queryOption) {\n  var meta = (0, _query.getQueryConfig)(queryOption);\n\n  for (var _len2 = arguments.length, args = new Array(_len2 > 3 ? _len2 - 3 : 0), _key2 = 3; _key2 < _len2; _key2++) {\n    args[_key2 - 3] = arguments[_key2];\n  }\n\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, meta),\n    method: 'set',\n    meta: meta,\n    args: args,\n    types: [_constants.actionTypes.SET_REQUEST, _constants.actionTypes.SET_SUCCESS, _constants.actionTypes.SET_FAILURE]\n  });\n}\n\nfunction get(firebase, dispatch, queryOption) {\n  var meta = (0, _query.getQueryConfig)(queryOption);\n\n  var _ref = firebase._.config || {},\n      mergeOrdered = _ref.mergeOrdered,\n      mergeOrderedDocUpdates = _ref.mergeOrderedDocUpdates,\n      mergeOrderedCollectionUpdates = _ref.mergeOrderedCollectionUpdates;\n\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, meta),\n    method: 'get',\n    meta: meta,\n    types: [_constants.actionTypes.GET_REQUEST, {\n      type: _constants.actionTypes.GET_SUCCESS,\n      payload: function payload(snap) {\n        return {\n          data: (0, _query.dataByIdSnapshot)(snap),\n          ordered: (0, _query.orderedFromSnap)(snap)\n        };\n      },\n      merge: {\n        docs: mergeOrdered && mergeOrderedDocUpdates,\n        collections: mergeOrdered && mergeOrderedCollectionUpdates\n      }\n    }, _constants.actionTypes.GET_FAILURE]\n  });\n}\n\nfunction update(firebase, dispatch, queryOption) {\n  var meta = (0, _query.getQueryConfig)(queryOption);\n\n  for (var _len3 = arguments.length, args = new Array(_len3 > 3 ? _len3 - 3 : 0), _key3 = 3; _key3 < _len3; _key3++) {\n    args[_key3 - 3] = arguments[_key3];\n  }\n\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, meta),\n    method: 'update',\n    meta: meta,\n    args: args,\n    types: [_constants.actionTypes.UPDATE_REQUEST, _constants.actionTypes.UPDATE_SUCCESS, _constants.actionTypes.UPDATE_FAILURE]\n  });\n}\n\nfunction deleteRef(firebase, dispatch, queryOption) {\n  var meta = (0, _query.getQueryConfig)(queryOption);\n  var config = firebase._.config;\n\n  if (!meta.doc || meta.subcollections && !(0, _every2.default)(meta.subcollections, 'doc')) {\n    if (typeof config.onAttemptCollectionDelete === 'function') {\n      return config.onAttemptCollectionDelete(queryOption, dispatch, firebase);\n    }\n\n    return Promise.reject(new Error('Only documents can be deleted.'));\n  }\n\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: (0, _query.firestoreRef)(firebase, meta),\n    method: 'delete',\n    meta: meta,\n    types: [_constants.actionTypes.DELETE_REQUEST, {\n      type: _constants.actionTypes.DELETE_SUCCESS,\n      preserve: firebase._.config.preserveOnDelete\n    }, _constants.actionTypes.DELETE_FAILURE]\n  });\n}\n\nfunction setListener(firebase, dispatch, queryOpts, successCb, errorCb) {\n  var meta = (0, _query.getQueryConfig)(queryOpts);\n  var unsubscribe = (0, _query.firestoreRef)(firebase, meta).onSnapshot(function (docData) {\n    if (!meta.populates) {\n      (0, _query.dispatchListenerResponse)({\n        dispatch: dispatch,\n        docData: docData,\n        meta: meta,\n        firebase: firebase\n      });\n      if (typeof successCb === 'function') successCb(docData);\n      return;\n    }\n\n    (0, _query.getPopulateActions)({\n      firebase: firebase,\n      docData: docData,\n      meta: meta\n    }).then(function (populateActions) {\n      populateActions.forEach(function (populateAction) {\n        dispatch(_objectSpread({}, populateAction, {\n          type: _constants.actionTypes.LISTENER_RESPONSE,\n          timestamp: Date.now()\n        }));\n      });\n      (0, _query.dispatchListenerResponse)({\n        dispatch: dispatch,\n        docData: docData,\n        meta: meta,\n        firebase: firebase\n      });\n    }).catch(function (populateErr) {\n      var _ref2 = firebase._.config || {},\n          logListenerError = _ref2.logListenerError;\n\n      if (logListenerError !== false) {\n        if (logListenerError !== false && !!console && typeof console.error === 'function') {\n            console.error('redux-firestore error populating:', populateErr);\n          }\n      }\n\n      if (typeof errorCb === 'function') errorCb(populateErr);\n    });\n  }, function (err) {\n    var _ref3 = firebase._.config || {},\n        mergeOrdered = _ref3.mergeOrdered,\n        mergeOrderedDocUpdates = _ref3.mergeOrderedDocUpdates,\n        mergeOrderedCollectionUpdates = _ref3.mergeOrderedCollectionUpdates,\n        logListenerError = _ref3.logListenerError,\n        preserveOnListenerError = _ref3.preserveOnListenerError;\n\n    if (logListenerError !== false && !!console && typeof console.error === 'function') {\n        console.error('redux-firestore listener error:', err);\n      }\n\n    dispatch({\n      type: _constants.actionTypes.LISTENER_ERROR,\n      meta: meta,\n      payload: err,\n      merge: {\n        docs: mergeOrdered && mergeOrderedDocUpdates,\n        collections: mergeOrdered && mergeOrderedCollectionUpdates\n      },\n      preserve: preserveOnListenerError\n    });\n    if (typeof errorCb === 'function') errorCb(err);\n  });\n  (0, _query.attachListener)(firebase, dispatch, meta, unsubscribe);\n  return unsubscribe;\n}\n\nfunction setListeners(firebase, dispatch, listeners) {\n  if (!Array.isArray(listeners)) {\n    throw new Error('Listeners must be an Array of listener configs (Strings/Objects).');\n  }\n\n  var config = firebase._.config;\n\n  if (config.oneListenerPerPath) {\n    listeners.forEach(function (listener) {\n      var path = (0, _query.getQueryName)(listener);\n      var oldListenerCount = pathListenerCounts[path] || 0;\n      pathListenerCounts[path] = oldListenerCount + 1;\n\n      if (oldListenerCount > 0) {\n        return;\n      }\n\n      setListener(firebase, dispatch, listener);\n    });\n  } else {\n    var allowMultipleListeners = config.allowMultipleListeners;\n    listeners.forEach(function (listener) {\n      var path = (0, _query.getQueryName)(listener);\n      var oldListenerCount = pathListenerCounts[path] || 0;\n      var multipleListenersEnabled = typeof allowMultipleListeners === 'function' ? allowMultipleListeners(listener, firebase._.listeners) : allowMultipleListeners;\n      pathListenerCounts[path] = oldListenerCount + 1;\n\n      if (oldListenerCount === 0 || multipleListenersEnabled) {\n        setListener(firebase, dispatch, listener);\n      }\n    });\n  }\n}\n\nfunction unsetListener(firebase, dispatch, meta) {\n  return (0, _query.detachListener)(firebase, dispatch, (0, _query.getQueryConfig)(meta));\n}\n\nfunction unsetListeners(firebase, dispatch, listeners) {\n  if (!Array.isArray(listeners)) {\n    throw new Error('Listeners must be an Array of listener configs (Strings/Objects).');\n  }\n\n  var config = firebase._.config;\n  var allowMultipleListeners = config.allowMultipleListeners;\n  listeners.forEach(function (listener) {\n    var path = (0, _query.getQueryName)(listener);\n    var listenerExists = pathListenerCounts[path] >= 1;\n    var multipleListenersEnabled = typeof allowMultipleListeners === 'function' ? allowMultipleListeners(listener, firebase._.listeners) : allowMultipleListeners;\n\n    if (listenerExists) {\n      pathListenerCounts[path] -= 1;\n\n      if (pathListenerCounts[path] === 0 || multipleListenersEnabled) {\n        unsetListener(firebase, dispatch, listener);\n      }\n    }\n  });\n}\n\nfunction runTransaction(firebase, dispatch, transactionPromise) {\n  return (0, _actions.wrapInDispatch)(dispatch, {\n    ref: firebase.firestore(),\n    method: 'runTransaction',\n    args: [transactionPromise],\n    types: [_constants.actionTypes.TRANSACTION_START, _constants.actionTypes.TRANSACTION_SUCCESS, _constants.actionTypes.TRANSACTION_FAILURE]\n  });\n}\n\nvar _default = {\n  get: get,\n  firestoreRef: _query.firestoreRef,\n  add: add,\n  update: update,\n  setListener: setListener,\n  setListeners: setListeners,\n  unsetListener: unsetListener,\n  unsetListeners: unsetListeners,\n  runTransaction: runTransaction\n};\nexports.default = _default;"]},"metadata":{},"sourceType":"script"}